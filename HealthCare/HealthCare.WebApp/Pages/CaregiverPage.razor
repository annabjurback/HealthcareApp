@page "/caregiverpage"
@using HealthCare.WebApp.Services
@using HealthCare.Core.Models
@inject UserDataService UserDataService
@*@inject HealthCare.Core.Models.Booking Booking*@

@code{
    public string CaregiverId;
    private bool isFirstRender = true;
    public DateTime Date = DateTime.Now;
    public string Note = null;
    public bool Completed = false;
    public string PatientID = null;
    public bool CanBeBooked = false;
    public List<Booking> Bookings = new List<Booking>();


    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        CaregiverId = await UserDataService.GetUserIdAsync();

    }

    public async Task CreateEmptyMeeting(){

        CheckOverlapingTimeInCalender(Date);

        using var httpClient = new HttpClient(new HttpClientHandler())
            {
                BaseAddress = new Uri("https://localhost:7139/")
            };

        if (CanBeBooked)
        {
            var apiEndpoint = $"/api/booking/?start={Date}&note={Note}&completed={Completed}&patientId={PatientID}&caregiverId={CaregiverId}";
            var getBookingResponse = await httpClient.PostAsync(apiEndpoint, null);
        }
    }

    public async Task CheckOverlapingTimeInCalender(DateTime Date)
    {
        using var httpClient = new HttpClient(new HttpClientHandler())
            {
                BaseAddress = new Uri("https://localhost:7139/")
            };

        var apiEndpoint = $"/api/booking?Id={CaregiverId}";
        var getBookingResponse = await httpClient.GetAsync(apiEndpoint);

        if (getBookingResponse.IsSuccessStatusCode)
        {
            Bookings = await getBookingResponse.Content.ReadFromJsonAsync<List<Booking>>();

            foreach(var meting in Bookings)
            {
                if (Date >= meting.Start && Date < meting.End)
                {
                    CanBeBooked = false;
                }
                else
                {
                    CanBeBooked = true;
                }
            }
            
        }

    }
}

<div class="top-banner">
    <img src="BannerCaregiver.jpg" alt="Top Banner">
</div>

<div class="navigation">
    <button class="navigation_button" id="calendarBtn">Calendar</button>
    <button class="navigation_button" id="salaryBtn">Salary</button>
    <button class="navigation_button" id="settingsBtn">Settings</button>
</div>

<div class="sub-navigation">
    <form class="booking_form" @onsubmit="CreateEmptyMeeting">
        <div>Create meeting</div>
        <input @bind="Date" type="datetime-local"/>
        <button class="navigation_button" type="submit">Submit</button>
        
    </form>
</div>

<div class="week-view">
    <div class="day-container" id="monday-container">
        <div class="day-label">Monday</div>
        <div class="day-content">
        </div>
    </div>
    <div class="day-container" id="tuesday-container">
        <div class="day-label">Tuesday</div>
        <div class="day-content">
        </div>
    </div>
    <div class="day-container" id="wednesday-container">
        <div class="day-label">Wednesday</div>
        <div class="day-content">
        </div>
    </div>
    <div class="day-container" id="thursday-container">
        <div class="day-label">Thursday</div>
        <div class="day-content">
        </div>
    </div>
    <div class="day-container" id="friday-container">
        <div class="day-label">Friday</div>
        <div class="day-content">
        </div>
    </div>
</div>

@*<style>
    body {
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 0;
        background-color: #C7DCE2;
    }

    .top-banner img {
        width: 100vw;
        height: 30vh; 
        object-fit: cover; 
        display: block; 
    }

    .navigation {
        display: flex;
        justify-content: space-around;
        padding: 10px;
        background: rgb(135,192,203);
        background: linear-gradient(0deg, rgba(135,192,203,1) 16%, rgba(88,152,164,1) 98%);
    }

    .navigation button {
        padding: 10px 20px;
        border: none;
        background: rgb(133,190,200);
        background: linear-gradient(0deg, rgba(133,190,200,1) 16%, rgba(255,255,255,1) 98%);
        color: white;
        cursor: pointer;
        border-radius: 21px;
        box-shadow: 5px 20px 30px -7px rgba(0,0,0,0.4);
        -webkit-box-shadow: 5px 20px 30px -7px rgba(0,0,0,0.4);
        -moz-box-shadow: 5px 20px 30px -7px rgba(0,0,0,0.4);
    }

    .sub-navigation {
        display: flex;
        justify-content: space-around;
        padding: 10px;
        background:
    }

    .week-view {
        display: flex;
        justify-content: space-between;
        padding: 10px;
        background-color: #C7DCE2;
        flex: 1;
    }

    .day-container {
        background-color: white;
        margin: 5px;
        border-radius: 10px;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        flex-grow: 1;
        box-shadow: 5px 20px 30px -7px rgba(0,0,0,0.4);
        -webkit-box-shadow: 5px 20px 30px -7px rgba(0,0,0,0.4);
        -moz-box-shadow: 5px 20px 30px -7px rgba(0,0,0,0.4);
        min-height: 55vh;
    }

    .day-label {
        color: #333;
        padding: 10px;
        text-align: center;
        font-weight: bold;
        margin: 5%;
        background-color: #F1ECEC;
        border-radius: 15px;
        box-shadow: 0px 4px 4px 0px #00000040;
    }

    .day-content {
        padding: 20px;
        flex-grow: 1;
    }
</style>*@