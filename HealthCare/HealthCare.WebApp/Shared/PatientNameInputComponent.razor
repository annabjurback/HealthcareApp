@inject UserDataService UserDataService
@inject NavigationManager NavigationManager
@inject HealthCare.Core.Models.Patient patient
@using HealthCare.WebApp.Services
@using HealthCare.Core.Controllers;
@using Microsoft.AspNetCore.WebUtilities


<h3>Please enter your name:</h3>
<input type="text" @bind="firstName" placeholder="First name" />
<input type="text" @bind="lastName" placeholder="Last name" />
<button @onclick="SavePatientName">Save name</button>


@code {
	[Parameter]
	public EventCallback<int> OnNameSaved { get; set; }

	// [Parameter]
	public string firstName { get; set; }

	// [Parameter]
	public string lastName { get; set; }

	private string _userId;

	public string userId
	{
		get { return _userId; }
		set { 
			value = UserDataService.GetUserId();
			_userId = value; 
			}
	}

	// protected async Task Delete_Click()
	// {
	// 	await EmployeeService.DeleteEmployee(Employee.EmployeeId);
	// 	await OnEmployeeDeleted.InvokeAsync(Employee.EmployeeId);
	// 	//NavigationManager.NavigateTo("/", true);
	// }


	private async Task SavePatientName()
	{
		var httpClient = new HttpClient(new HttpClientHandler());
		httpClient.BaseAddress = new Uri("https://localhost:7139/");

		var query = new Dictionary<string, string>()
		{
			["id"] = userId,
			["firstName"] = firstName ?? "",
			["lastName"] = lastName ?? ""
		};

		var uri = QueryHelpers.AddQueryString("/api/patient", query!);
		var savePatientResponse = await httpClient.PutAsync(uri, null);

		if (!savePatientResponse.IsSuccessStatusCode)
		{
			NavigationManager.NavigateTo("/Error");
		}

		await OnNameSaved.InvokeAsync();
		// antingen här elelr i patientpage saknas nåt. pats namn sparas inte i db iaf.. och vi hamnar i program.cs igen.. något skumt måste det vara här..
	}
}

		